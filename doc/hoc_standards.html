<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
           "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<meta name="GENERATOR" content="TtH 3.82">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>

  
<title> {Standards and Coding Practices for CLUBB}</title>
 
<h1 align="center"><b>Standards and Coding Practices for CLUBB</b> </h1>

<h3 align="center">Larson Group UW-Milwaukee </h3>

<div class="p"><!----></div>
The following rules apply only to the parts of CLUBB that we have written.  We try not to modify
code from external contributors such as BUGSRad, 
Numerical Recipes, and so forth, because such external code is
less familiar to us, and we might introduce bugs.  Furthermore, our changes would be lost if
we were to update to a new version of the external code.

<div class="p"><!----></div>

<ol type="1">
<li> All files in the repository should have a standard header with a SVN 
<tt>$Id$</tt> tag at the top.

<div class="p"><!----></div>
When initially checking in a new source file, enter the Id tag as 
the string <tt>$Id$</tt> on a commented line at the top of the source file
 (SVN will expand this after checking it in).

<div class="p"><!----></div>
<br /><br />After checking in the file, something like the following will appear:

<pre>
!-----------------------------------------------------------------------
!&nbsp;$Id:&nbsp;hoc_standards.tex,v&nbsp;1.4&nbsp;2008-08-18&nbsp;17:53:48&nbsp;dschanen&nbsp;Exp&nbsp;$


</pre>
<div class="p"><!----></div>
</li>

<li> When adding functions and subroutines create a header with a short 
description of their purpose and reference if there is one.  Include 
in the header a description of 
each variable and its respective units.  Use the following standardized
layout: 

<div class="p"><!----></div>

<pre>
!-----------------------------------------------------------------------
function&nbsp;xyzzy(&nbsp;etherx,&nbsp;ethery,&nbsp;etherz&nbsp;)

!&nbsp;Description:
!&nbsp;&nbsp;&nbsp;Evaluates&nbsp;the&nbsp;xyzzy&nbsp;function.&nbsp;

!&nbsp;References:
!&nbsp;&nbsp;&nbsp;Eqn.&nbsp;33&nbsp;on&nbsp;p.&nbsp;4551&nbsp;of&nbsp;&nbsp;
!&nbsp;&nbsp;&nbsp;Tweedle-dee&nbsp;and&nbsp;Tweedle-dum&nbsp;(1842),&nbsp;J.&nbsp;Imaginary&nbsp;Atmospheric&nbsp;
!&nbsp;&nbsp;&nbsp;Sci.,&nbsp;Vol.&nbsp;23,&nbsp;pp.&nbsp;4550--4556
!-----------------------------------------------------------------------

&nbsp;&nbsp;!&nbsp;Included&nbsp;Modules
&nbsp;&nbsp;use&nbsp;grid_dimensions,&nbsp;only:&nbsp;ndim
&nbsp;
&nbsp;&nbsp;implicit&nbsp;none

&nbsp;&nbsp;!&nbsp;External&nbsp;Calls
&nbsp;&nbsp;complex,&nbsp;external&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;xyxy_fnc&nbsp;!&nbsp;(Description&nbsp;of&nbsp;function&nbsp;goes&nbsp;here)

&nbsp;&nbsp;external&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;zyzy_sub&nbsp;!&nbsp;(Description&nbsp;of&nbsp;subroutine&nbsp;goes&nbsp;here)

&nbsp;&nbsp;!&nbsp;It&nbsp;is&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;declare&nbsp;intrinsics,&nbsp;in&nbsp;case&nbsp;another&nbsp;
&nbsp;&nbsp;!&nbsp;function&nbsp;or&nbsp;variable&nbsp;is&nbsp;accidentally&nbsp;given&nbsp;the&nbsp;same&nbsp;name.
&nbsp;&nbsp;intrinsic&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;matmul,&nbsp;exp,&nbsp;log,&nbsp;dble

&nbsp;&nbsp;!&nbsp;If&nbsp;we&nbsp;had&nbsp;any&nbsp;derived&nbsp;types&nbsp;to&nbsp;declare,&nbsp;then&nbsp;
&nbsp;&nbsp;!&nbsp;we&nbsp;would&nbsp;put&nbsp;them&nbsp;here&nbsp;before&nbsp;the&nbsp;constants.

&nbsp;&nbsp;!&nbsp;Local&nbsp;Constants
&nbsp;&nbsp;real,&nbsp;parameter&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;local_tol&nbsp;=&nbsp;1.0e-6&nbsp;!&nbsp;Local&nbsp;tolerance&nbsp;[no&nbsp;units]

&nbsp;&nbsp;!&nbsp;Input&nbsp;Variables
&nbsp;&nbsp;complex,&nbsp;dimension(ndim),&nbsp;intent(in)&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;etherx,&nbsp;&nbsp;!&nbsp;Ether&nbsp;in&nbsp;the&nbsp;x&nbsp;dimension&nbsp;&nbsp;[kg/kg]
&nbsp;&nbsp;&nbsp;&nbsp;ethery,&nbsp;&nbsp;!&nbsp;Ether&nbsp;in&nbsp;the&nbsp;y&nbsp;dimension&nbsp;&nbsp;[kg/kg]
&nbsp;&nbsp;&nbsp;&nbsp;etherz&nbsp;&nbsp;&nbsp;!&nbsp;Ether&nbsp;in&nbsp;the&nbsp;z&nbsp;dimension&nbsp;&nbsp;[kg/kg]

&nbsp;&nbsp;!&nbsp;Output&nbsp;Variables
&nbsp;&nbsp;complex,&nbsp;dimension(ndim,ndim,ndim)&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;xyzzy&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Ether&nbsp;in&nbsp;the&nbsp;xyyzy&nbsp;dimension&nbsp;&nbsp;[kg/kg]

&nbsp;&nbsp;!&nbsp;Local&nbsp;Variables
&nbsp;&nbsp;integer&nbsp;::&nbsp;i,&nbsp;j,&nbsp;k

!-----------------------------------------------------------------------

&nbsp;&nbsp;!-----&nbsp;Begin&nbsp;Code&nbsp;-----

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;return
end&nbsp;function&nbsp;xyzzy
!-----------------------------------------------------------------------

</pre>
<div class="p"><!----></div>
</li>

<li> In functions and subroutines put a line with 
<tt>!-----&nbsp;Begin&nbsp;Code&nbsp;-----</tt> after the declarative portion of the code.
This is to make it clear where the algorithmic portion of the procedure starts.
<div class="p"><!----></div>
</li>

<li> Write lots of code comments.  Make sure your code is understandable to an outsider 
looking at it for the first time.  When writing a code comment, leave your name 
at the end of the comment.
This will allow other users to contact you with any questions about the section of code.
Use the same name identifier, e.g. dschanen or Vince Larson, everywhere.
Then everyone can use <tt>grep</tt> to search for all code comments you've made.
<div class="p"><!----></div>
</li>

<li> Minimize the number of variables or amount of data made available to any 
subroutine in either 
passed arguments or <tt>use</tt> statements.  Always specify <tt>intent</tt> 
attributes on your arguments, and use <tt>intent(in)</tt> 
and <tt>intent(out)</tt> rather than <tt>intent(inout)</tt> whenever possible.
This makes the code more clear to new users by allowing them to trace where a 
given variable is changed in the code and spot at a glance what are the inputs and
outputs of each subroutine.  Furthermore,
this makes it easier for the compiler to optimize, because modern computers can 
vectorize floating point instructions, thereby providing some 
parallelization when your calculation does not rely on previous results.
Note however, than an <tt>intent(out)</tt> variable that is not set in the scope of the subroutine
is <em>not defined</em>!  It often preserves the previous value, but it may not.
When using modules with public variables, limit 
the number of variables with an <tt>only:</tt> statement.  This makes code 
easier to read, because it is then obvious which variables from the module are being 
used.
<div class="p"><!----></div>
E.g.

<pre>
!-----------------------------------------------------------------------
subroutine&nbsp;mulmul(&nbsp;x,&nbsp;y,&nbsp;z&nbsp;)

!&nbsp;Description:
!&nbsp;&nbsp;&nbsp;Bogus&nbsp;example

!&nbsp;References:
!&nbsp;&nbsp;&nbsp;None
!-----------------------------------------------------------------------

&nbsp;&nbsp;!&nbsp;Here&nbsp;we&nbsp;limit&nbsp;our&nbsp;use&nbsp;statement&nbsp;to&nbsp;just&nbsp;the&nbsp;needed&nbsp;variables
&nbsp;&nbsp;use&nbsp;constants,&nbsp;only:&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;pi,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;!&nbsp;Ratio&nbsp;of&nbsp;radii&nbsp;to&nbsp;their&nbsp;circumferance&nbsp;[no&nbsp;units]
&nbsp;&nbsp;&nbsp;&nbsp;euler_const&nbsp;&nbsp;&nbsp;!&nbsp;Made&nbsp;up&nbsp;constant&nbsp;[no&nbsp;units]

&nbsp;&nbsp;use&nbsp;dimensions,&nbsp;only:&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;nnzp&nbsp;!&nbsp;Number&nbsp;of&nbsp;data&nbsp;points&nbsp;of&nbsp;our&nbsp;model&nbsp;[count]

&nbsp;&nbsp;implicit&nbsp;none

&nbsp;&nbsp;!&nbsp;First&nbsp;list&nbsp;input&nbsp;variables
&nbsp;&nbsp;real,&nbsp;dimension(nnzp),&nbsp;intent(in)&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;x,&nbsp;&amp;!&nbsp;First&nbsp;factor&nbsp;&nbsp;&nbsp;[no&nbsp;units]
&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;!&nbsp;Second&nbsp;factor&nbsp;&nbsp;[no&nbsp;units]

&nbsp;&nbsp;!&nbsp;Then&nbsp;list&nbsp;inout&nbsp;variables,&nbsp;and&nbsp;then&nbsp;outputs&nbsp;
&nbsp;&nbsp;real,&nbsp;dimension(nnzp),&nbsp;intent(out)&nbsp;::&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;&nbsp;!&nbsp;output&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[no&nbsp;units]
!-----------------------------------------------------------------------

&nbsp;&nbsp;!-----&nbsp;Begin&nbsp;Code&nbsp;-----

&nbsp;&nbsp;!&nbsp;Note&nbsp;that&nbsp;every&nbsp;element&nbsp;of&nbsp;z&nbsp;could&nbsp;be&nbsp;calculated&nbsp;
&nbsp;&nbsp;!&nbsp;independently&nbsp;of&nbsp;other&nbsp;elements&nbsp;of&nbsp;the&nbsp;subroutine
&nbsp;&nbsp;!&nbsp;allowing&nbsp;for&nbsp;parallelism&nbsp;if&nbsp;possible.

&nbsp;&nbsp;z(1:nnzp)&nbsp;=&nbsp;(&nbsp;x(1:nnzp)&nbsp;/&nbsp;pi&nbsp;)&nbsp;*&nbsp;(&nbsp;y(1:nnzp)&nbsp;/&nbsp;euler_const&nbsp;)

&nbsp;&nbsp;return
end&nbsp;subroutine&nbsp;mulmul
!-----------------------------------------------------------------------

</pre>
<div class="p"><!----></div>
</li>

<li> The general convention in CLUBB is to have the dummy arguments of a subroutine 
ordered with input first, input/output second, and output arguments third. 
The exception to this is optional variables, which must occur last.  In that case,
standard variables should be ordered as above; below this, the optional variables should
be listed with input first, then input/output, and then output variables.

<div class="p"><!----></div>
E.g.

<pre>

&nbsp;&nbsp;!&nbsp;The&nbsp;wrong&nbsp;way
&nbsp;&nbsp;subroutine&nbsp;sub(&nbsp;input_variable_1,&nbsp;output_variable_1,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_variable_2,&nbsp;input_output_variable_1&nbsp;)

&nbsp;&nbsp;!&nbsp;The&nbsp;right&nbsp;way
&nbsp;&nbsp;subroutine&nbsp;sub(&nbsp;input_variable_1,&nbsp;input_variable_2,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_output_variable_1,&nbsp;output_variable_1&nbsp;)


</pre>
<div class="p"><!----></div>
</li>

<li> Keep on the same lines the arguments of both the originating call and its 
corresponding subroutine declaration.  This makes it easier to check the 
consistency of arguments of subroutines and functions with long argument lists.

<div class="p"><!----></div>
 E.g.

<pre>

&nbsp;&nbsp;!&nbsp;The&nbsp;wrong&nbsp;way
&nbsp;&nbsp;call&nbsp;sub(&nbsp;roast_beef,&nbsp;ham,&nbsp;tomato,&nbsp;cheese,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lettuce,&nbsp;onion,&nbsp;mayo&nbsp;)

&nbsp;&nbsp;subroutine&nbsp;sub(&nbsp;roast_beef,&nbsp;ham,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tomato,&nbsp;cheese,&nbsp;&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lettuce,&nbsp;onion,&nbsp;mayo&nbsp;)

&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;right&nbsp;way
&nbsp;&nbsp;&nbsp;call&nbsp;sub(&nbsp;roast_beef,&nbsp;ham,&nbsp;tomato,&nbsp;cheese,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lettuce,&nbsp;onion,&nbsp;mayo&nbsp;)

&nbsp;&nbsp;&nbsp;subroutine&nbsp;sub(&nbsp;roast_beef,&nbsp;ham,&nbsp;tomato,&nbsp;cheese,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lettuce,&nbsp;onion,&nbsp;mayo&nbsp;)


</pre>
<div class="p"><!----></div>
</li>

<li> When breaking up an arithmetic expression over multiple lines, do so according to 
operator precedence.  This makes things more readable at a glance. 
<div class="p"><!----></div>
E.g. Do this: 

<pre>
&nbsp;&nbsp;x&nbsp;=&nbsp;t&nbsp;+&nbsp;y*x&nbsp;&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;g*v&nbsp;+&nbsp;t*h

</pre>

<div class="p"><!----></div>
Not this:

<pre>
&nbsp;&nbsp;x&nbsp;=&nbsp;t&nbsp;+&nbsp;y*x&nbsp;+&nbsp;g&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;*v&nbsp;+&nbsp;t*h

</pre>
<div class="p"><!----></div>
</li>

<li> Do not use assumed size or assumed shape arrays in CLUBB.  
Generally speaking, the grid class defines the length of model arrays, 
and the use of assumed size arrays introduces 
another level of complexity that can cause bugs.  An exception may occur
if you need to interface with code developed by external contributors that
contains assumed shape arrays.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> When a logical expression or a do loop extends more than ten lines, put a
small comment after the end statement with the name of the loop or logical
variable.
E.g. 
<div class="p"><!----></div>

<pre>
&nbsp;&nbsp;if&nbsp;(&nbsp;lcode_enabled&nbsp;)&nbsp;then

&nbsp;&nbsp;&nbsp;&nbsp;...many&nbsp;lines&nbsp;of&nbsp;code...

&nbsp;&nbsp;end&nbsp;if&nbsp;!&nbsp;lcode_enabled

</pre>

<div class="p"><!----></div>
or 

<div class="p"><!----></div>

<pre>
&nbsp;&nbsp;if&nbsp;(&nbsp;.not.&nbsp;lcode_enabled&nbsp;)&nbsp;then

&nbsp;&nbsp;&nbsp;&nbsp;...many&nbsp;lines&nbsp;of&nbsp;code...

&nbsp;&nbsp;end&nbsp;if&nbsp;!&nbsp;~lcode_enabled

</pre>

<div class="p"><!----></div>
A long do statement

<div class="p"><!----></div>

<pre>
&nbsp;&nbsp;do&nbsp;i&nbsp;=&nbsp;1,&nbsp;100,&nbsp;1

&nbsp;&nbsp;...many&nbsp;lines&nbsp;of&nbsp;code...

&nbsp;&nbsp;end&nbsp;do&nbsp;!&nbsp;i&nbsp;=&nbsp;1..100

</pre>
<div class="p"><!----></div>
</li>

<li> When making a logical expression, leave spaces between the 
logical operators and use the Fortran 90 style logical operators. 
<div class="p"><!----></div>
 E.g.

<pre>
&nbsp;&nbsp;!&nbsp;Like&nbsp;this
&nbsp;&nbsp;if&nbsp;(&nbsp;x&nbsp;==&nbsp;y&nbsp;)&nbsp;.and.&nbsp;(&nbsp;y&nbsp;&#62;=&nbsp;z&nbsp;)&nbsp;.or.&nbsp;(&nbsp;z&nbsp;/=&nbsp;0.0&nbsp;)&nbsp;then

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;end&nbsp;if

&nbsp;&nbsp;!&nbsp;Not&nbsp;like&nbsp;this
&nbsp;&nbsp;if&nbsp;(&nbsp;x.eq.y.and.y.ge.z.or.z.ne.0.0&nbsp;)&nbsp;then

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;end&nbsp;if


</pre>

<div class="p"><!----></div>
The F90 style operators are:

<div class="p"><!----></div>

<pre>
==&nbsp;instead&nbsp;of&nbsp;.eq.
/=&nbsp;instead&nbsp;of&nbsp;.ne.
&#62;&nbsp;&nbsp;instead&nbsp;of&nbsp;.gt.
&#62;=&nbsp;instead&nbsp;of&nbsp;.ge.
&lt;&nbsp;&nbsp;instead&nbsp;of&nbsp;.lt.
&lt;=&nbsp;instead&nbsp;of&nbsp;.le.

</pre>
<div class="p"><!----></div>
</li>

<li> When creating a model flag variable of type <tt>logical</tt>, precede the
 name with a <tt>l_</tt> to make it easy to see that it is a logical.
<div class="p"><!----></div>
</li>

<li> When writing flow control statements 
(<tt> if, else if, select case </tt>), keep the logic as straightforward and
clear as possible.  If a set of <tt>if...then</tt> expressions grows to more
than three cases, then rewrite the logic as a <tt>select...case</tt> expression
instead. E.g.

<div class="p"><!----></div>

<pre>
&nbsp;&nbsp;!&nbsp;Rewrite&nbsp;this:
&nbsp;&nbsp;if&nbsp;(&nbsp;trim(&nbsp;run&nbsp;)&nbsp;==&nbsp;"BOMEX"&nbsp;)&nbsp;then
&nbsp;&nbsp;&nbsp;&nbsp;execute_stuff(&nbsp;)

&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;trim(&nbsp;run&nbsp;)&nbsp;==&nbsp;"FIRE"&nbsp;)&nbsp;then
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_stuff(&nbsp;)

&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;trim(&nbsp;run&nbsp;)&nbsp;==&nbsp;"ARM"&nbsp;)&nbsp;then
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_other_stuff(&nbsp;)&nbsp;

&nbsp;&nbsp;else&nbsp;if&nbsp;(&nbsp;trim(&nbsp;run&nbsp;)&nbsp;==&nbsp;"DAVE'S_CAMPING_TRIP"&nbsp;)&nbsp;then
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_other_other_stuff(&nbsp;)&nbsp;

&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;write(unit=0,fmt=*)&nbsp;"Cannot&nbsp;determine&nbsp;what&nbsp;to&nbsp;do&nbsp;for&nbsp;"//trim(&nbsp;run&nbsp;)

&nbsp;&nbsp;end&nbsp;if&nbsp;!&nbsp;run

&nbsp;&nbsp;!&nbsp;Like&nbsp;this:
&nbsp;&nbsp;select&nbsp;case(&nbsp;trim(&nbsp;run&nbsp;)&nbsp;)
&nbsp;&nbsp;case(&nbsp;"BOMEX"&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;execute_stuff(&nbsp;)

&nbsp;&nbsp;case(&nbsp;"FIRE"&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_stuff(&nbsp;)

&nbsp;&nbsp;case(&nbsp;"ARM"&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_other_stuff(&nbsp;)
&nbsp;
&nbsp;&nbsp;case&nbsp;(&nbsp;"DAVE'S_CAMPING_TRIP"&nbsp;)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;execute_other_other_other_stuff(&nbsp;)&nbsp;

&nbsp;&nbsp;case&nbsp;default
&nbsp;&nbsp;&nbsp;&nbsp;write(unit=0,fmt=*)&nbsp;"Cannot&nbsp;determine&nbsp;what&nbsp;to&nbsp;do&nbsp;for&nbsp;"//trim(&nbsp;run&nbsp;)

&nbsp;&nbsp;end&nbsp;select&nbsp;!&nbsp;run


</pre>
<div class="p"><!----></div>
</li>

<li> When mixing scalar variables with array variables in a single
mathematical statement, it is often more clear to use indices, even
though Fortran 90 allows you to omit them. 
<div class="p"><!----></div>
E.g. Do this:

<div class="p"><!----></div>

<pre>
&nbsp;xyzzy(1:gr%nnzp)&nbsp;=&nbsp;variable_arr1(1:gr%nnzp)&nbsp;*&nbsp;variable_scl1&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;variable_arr2(1:gr%nnzp)**2

</pre>

<div class="p"><!----></div>
Not this:

<pre>
&nbsp;xyzzy&nbsp;=&nbsp;variable_arr1&nbsp;*&nbsp;variable_scl1&nbsp;&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;variable_arr2**2

</pre>
<div class="p"><!----></div>
</li>

<li> Use a consistent character case for variables names. 
E.g. if you use <tt>thlm</tt> in function a, then do not use <tt>Thlm</tt> in function b. 
This makes the code easier to read and search using your text editor and the 
<tt>grep</tt> command.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Always use <tt>implicit none</tt> in your code.  It will make 
debugging much easier, because it prevents the accidental use of 
variables of the wrong type.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> When adding a variable that isn't a loop iterator and occurs in more 
than one context, use a variable name that is in some way unique. 
This will make searching for the variable in the code much easier. 
There several ways to do this:
	
<ol type="a">
<li> Use mixed case.  E.g. <tt>Rd</tt> for the Dry air gas constant 
	rather than <tt>R</tt> or <tt>rd</tt>
<div class="p"><!----></div>
</li>

<li> Use of a number in the name when the mathematical equations 
	contain them. 
	 E.g. <tt>p0</tt> for P<sub>0</sub>.
<div class="p"><!----></div>
</li>

<li> Use 3 or more characters in the variable name.
	E.g. CLUBB uses <tt>grav</tt> 
	rather than <tt>g</tt> or <tt>gr</tt> for the gravitational constant.
<div class="p"><!----></div>
</li>
</ol>
Avoid using a variable name that overlaps with the text of a reserved word or
Fortran directive as well (e.g. <tt>inte</tt> overlaps with <tt>intent</tt> 
and <tt>integer</tt> and would not be a good variable name).
Try using a command
like <tt>grep</tt> if you're uncertain if your variable is a semi-unique string.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Do not use the prognostic or diagnostic variable modules anywhere they
are not used already.  Currently the module <tt>prognostic_variables</tt> 
is used in 
<tt>numer_check</tt> and <tt>clubb_driver</tt>, while 
<tt>diagnostic_variables</tt> is used in <tt>clubb_driver</tt>, 
<tt>clubb_core</tt>, 
and <tt>stats_subs</tt>. Global variables like these make debugging 
the code more difficult.  The proper way to use these variables in a new 
section of code is to pass them as an argument.

<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Put all functions and subroutines within a module.  This allows for 
compile time checking of input arguments. 
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> When putting several subroutines or functions in a module, limit the
 number of public interfaces to those that are called from outside the 
 module.<br />
E.g. 

<pre>
&nbsp;&nbsp;!&nbsp;module&nbsp;gcss

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;!&nbsp;Note&nbsp;that&nbsp;all&nbsp;these&nbsp;are&nbsp;subroutines&nbsp;called&nbsp;from&nbsp;
&nbsp;&nbsp;!&nbsp;hoc_forcings_timestep

&nbsp;&nbsp;public&nbsp;::
&nbsp;&nbsp;&nbsp;&nbsp;cloud_rad,&nbsp;atex_tndcy,&nbsp;atex_sfclyr,&nbsp;fire_tndcy,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;wangara_tndcy,&nbsp;wangara_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;astex_tndcy,&nbsp;astex_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;arm_tndcy,&nbsp;arm_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;bomex_tndcy,&nbsp;bomex_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;dycoms2_rf01_tndcy,&nbsp;dycoms2_rf01_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;dycoms2_rf02_tndcy,&nbsp;dycoms2_rf02_sfclyr,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;nov11_altocu_tndcy&nbsp;

&nbsp;&nbsp;!&nbsp;Note&nbsp;that&nbsp;all&nbsp;these&nbsp;are&nbsp;called&nbsp;from&nbsp;
&nbsp;&nbsp;!&nbsp;subroutines&nbsp;within&nbsp;gcss;&nbsp;&nbsp;This&nbsp;declaration
&nbsp;&nbsp;!&nbsp;makes&nbsp;them&nbsp;unavailable&nbsp;to&nbsp;outside&nbsp;routines

&nbsp;&nbsp;private&nbsp;::
&nbsp;&nbsp;&nbsp;&nbsp;diag_ustar,&nbsp;arm_sfcflx,&nbsp;Diff_denom,&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;altocu_icedf

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...


</pre>
<div class="p"><!----></div>
</li>

<li> Good use of whitespace can make code easier to read and debug.  
One simple convention used in CLUBB is to put an extra space between 
parenthesis for functions and subroutines to differentiate them from 
array variables. 
<div class="p"><!----></div>
E.g.

<pre>
&nbsp;&nbsp;!&nbsp;Choosing&nbsp;less&nbsp;obscure&nbsp;names&nbsp;for&nbsp;arrays&nbsp;and&nbsp;functions&nbsp;
&nbsp;&nbsp;!&nbsp;will&nbsp;also&nbsp;help&nbsp;with&nbsp;this&nbsp;problem.

&nbsp;&nbsp;f(&nbsp;x&nbsp;)&nbsp;!&nbsp;This&nbsp;is&nbsp;the&nbsp;function&nbsp;f&nbsp;evaluated&nbsp;with&nbsp;argument&nbsp;x.
&nbsp;&nbsp;f(x)&nbsp;&nbsp;&nbsp;!&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;dimensional&nbsp;array&nbsp;f&nbsp;indexed&nbsp;at&nbsp;x.

</pre>

<div class="p"><!----></div>
This applies to intrinsic functions as well. 
<div class="p"><!----></div>
E.g.

<pre>
&nbsp;&nbsp;mycalc&nbsp;=&nbsp;exp(&nbsp;x&nbsp;)&nbsp;*&nbsp;log(&nbsp;y&nbsp;)&nbsp;&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;dble(&nbsp;g&nbsp;)&nbsp;*&nbsp;mod(&nbsp;f,&nbsp;5&nbsp;)

</pre>
<div class="p"><!----></div>
</li>

<li> Code should not make use of explicit precision variables unless there is 
an unique reason for it (e.g. writing 4 byte records to disk).  This allows for 
compile time promotion of reals and doubles on different computer architectures.
Also, do not use the asterisks notation to specify precision, because
is an extension of the Fortran standard.  E.g.

<pre>
&nbsp;&nbsp;!&nbsp;This&nbsp;does&nbsp;not&nbsp;allow&nbsp;for&nbsp;compile&nbsp;time&nbsp;promotion.
&nbsp;&nbsp;real(kind=8)&nbsp;::&nbsp;x&nbsp;&nbsp;

&nbsp;&nbsp;!&nbsp;This&nbsp;is&nbsp;not&nbsp;standard&nbsp;Fortran&nbsp;and&nbsp;may&nbsp;break.
&nbsp;&nbsp;real*8&nbsp;::&nbsp;x

&nbsp;&nbsp;!&nbsp;Everyone&nbsp;will&nbsp;be&nbsp;happy&nbsp;if&nbsp;you&nbsp;keep&nbsp;it&nbsp;like&nbsp;this.
&nbsp;&nbsp;real&nbsp;::&nbsp;x&nbsp;!&nbsp;Marks&nbsp;the&nbsp;spot&nbsp;[deg_E]

</pre>
<div class="p"><!----></div>
</li>

<li> For clarity, functions, subroutines, modules, and programs should end 
with their proper Fortran 90 style end statement. 
<div class="p"><!----></div>
E.g.

<pre>
&nbsp;&nbsp;!&nbsp;Like&nbsp;this
&nbsp;&nbsp;subroutine&nbsp;foo

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;end&nbsp;subroutine&nbsp;foo

&nbsp;&nbsp;!&nbsp;Not&nbsp;like&nbsp;this
&nbsp;&nbsp;subroutine&nbsp;foo

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;end

</pre>
<div class="p"><!----></div>
</li>

<li> Separate end statements with a single space. 
<div class="p"><!----></div>
 E.g.

<pre>
&nbsp;&nbsp;subroutine&nbsp;sub(&nbsp;)

&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;do&nbsp;k&nbsp;=&nbsp;1,&nbsp;gr%nnzp,&nbsp;1

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;end&nbsp;do&nbsp;!&nbsp;not&nbsp;'enddo'

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;where&nbsp;(&nbsp;rtm&nbsp;&lt;&nbsp;rttol&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;end&nbsp;where&nbsp;!&nbsp;not&nbsp;'endwhere'

&nbsp;&nbsp;subroutine&nbsp;sub

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...

&nbsp;&nbsp;&nbsp;&nbsp;return
&nbsp;&nbsp;end&nbsp;subroutine&nbsp;sub&nbsp;!&nbsp;not&nbsp;'endsubroutine'

</pre>
<div class="p"><!----></div>
</li>

<li> Use lowercase letters for Fortran keywords. 
<div class="p"><!----></div>
E.g.

<pre>
program&nbsp;HAL&nbsp;!&nbsp;lowercase&nbsp;program

&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;

&nbsp;&nbsp;if&nbsp;(&nbsp;lTurnOff&nbsp;)&nbsp;then&nbsp;!&nbsp;lowercase&nbsp;if,&nbsp;lowercase&nbsp;then

&nbsp;&nbsp;&nbsp;&nbsp;write(unit=*,fmt=*)&nbsp;"I&nbsp;know&nbsp;that&nbsp;you&nbsp;and&nbsp;Frank&nbsp;were&nbsp;"&nbsp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//"trying&nbsp;to&nbsp;turn&nbsp;me&nbsp;off&nbsp;Dave."&nbsp;!&nbsp;lowercase&nbsp;write

&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;"Daisy,&nbsp;Daisy..."&nbsp;!&nbsp;lowercase&nbsp;stop

&nbsp;&nbsp;end&nbsp;if&nbsp;!&nbsp;lowercase&nbsp;end,&nbsp;lowercase&nbsp;if

&nbsp;&nbsp;&nbsp;&nbsp;...

end&nbsp;program&nbsp;HAL&nbsp;!&nbsp;lowercase&nbsp;end,&nbsp;lowercase&nbsp;program&nbsp;

</pre>
<div class="p"><!----></div>
</li>

<li> For the sake of consistency and code readability, always use a 2 column 
indent after all directives. Also, indent continuation lines by 2 columns. 
<div class="p"><!----></div>
E.g. <br />
<tt>module&nbsp;dynamics</tt> <br />
<tt>&nbsp;&nbsp;</tt> <font size="-1">2 column indent within the scope of <tt>module</tt></font> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;implicit</tt><tt>&nbsp;none</tt> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;contains</tt> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;subroutine</tt><tt>&nbsp;advect_2D(&nbsp;...&nbsp;)</tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;use</tt><tt>&nbsp;grid,&nbsp;only:&nbsp;&amp;&nbsp;</tt> <font size="-1">2+2 columns within the scope of <tt>dynamics/advect_2D</tt></font> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nz,</tt><tt>&nbsp;&amp;&nbsp;</tt> <font size="-1">2+2+2 columns since we're continuing the <tt>use</tt> statement</font>  <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nx</tt> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;if</tt><tt>&nbsp;(&nbsp;l_do_something&nbsp;)&nbsp;then</tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt> <font size="-1">2+2+2 columns within the scope of <tt>dynamics/advect_2D/if..then</tt></font> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>call&nbsp;something(&nbsp;...&nbsp;)</tt> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;end</tt><tt>&nbsp;if</tt> <br />
<tt></tt> <br />
<tt>&nbsp;&nbsp;&nbsp;&nbsp;return</tt> <br />
<tt>&nbsp;&nbsp;end</tt><tt>&nbsp;subroutine&nbsp;advect_2D</tt> <br />

<div class="p"><!----></div>
<tt>end&nbsp;module&nbsp;dynamics</tt>
<div class="p"><!----></div>
</li>

<li> Wrap all code lines at 100 columns.  Fortran free format source code
allows for 132, but the number 100 was chosen to so that we can view the code 
browser without word-wrap on one monitor.  
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>

<li> Do not use deprecated or obsolescent features of Fortran, and do not
use extensions to the Fortran 95 standard.  This includes but is not limited to
<tt>pause</tt>, <tt>equivalence</tt>, Cray style pointers, 
arithmetic <tt>if</tt>, alternate <tt>return</tt>, and <tt>float()</tt> for 
real data type conversions.
<div class="p"><!----></div>
</li>
</ol>

<div class="p"><!----></div>

<br /><br /><hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 3.82.<br />On 20 Jan 2009, 16:12.</small>
</html>
